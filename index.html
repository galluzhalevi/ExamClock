<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Clock - Setup</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        <div class="main-wrapper">
            <div class="setup-container">
                <div class="language-selector">
                    <span class="globe-icon">üåê</span>
                    <div class="lang-buttons">
                        <button class="lang-btn active">ENG</button>
                        <button class="lang-btn" onclick="window.location.href='index-he.html'">◊¢◊ë◊®</button>
                    </div>
                </div>

                <h1>Exam Setup</h1>

                <div class="input-card">
                    <div class="input-group">
                        <label>Start Time</label>
                        <input type="text" ref="startInput" v-model="startTime" @input="resetCalculation">
                    </div>

                    <div class="input-group">
                        <label>End Time</label>
                        <input type="text" ref="endInput" v-model="endTime" @input="resetCalculation">
                    </div>

                    <div class="input-group">
                        <label>Extra Time</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="text" ref="extraInput" v-model="extraTime" @input="resetCalculation" style="flex: 1;">
                            <button
                                :class="['action-btn', { active: is25PercentActive }]"
                                @click="calculate25Percent"
                                type="button"
                                style="width: auto; padding: 12px 20px;">
                                25%
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>Clock Increment (minutes)</label>
                        <div class="increment-buttons">
                            <button
                                v-for="inc in increments"
                                :key="inc"
                                @click="selectIncrement(inc)"
                                :class="['action-btn', { active: increment === inc }]"
                                type="button">
                                {{ inc }}
                            </button>
                        </div>
                    </div>

                    <button class="start-btn" @click="startExam">Start Exam Clock</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    startTime: '09:00',
                    endTime: '12:00',
                    extraTime: '13:00',
                    increment: 5,
                    increments: [1, 2, 5, 10, 12, 15],
                    extraPicker: null,
                    startPicker: null,
                    endPicker: null,
                    is25PercentActive: false
                }
            },
            methods: {
                initTimePickers() {
                    this.$nextTick(() => {
                        const config = {
                            enableTime: true,
                            noCalendar: true,
                            dateFormat: "H:i",
                            time_24hr: true,
                            allowInput: true,
                        };
                        this.startPicker = flatpickr(this.$refs.startInput, {
                            ...config,
                            defaultDate: this.startTime,
                            onChange: () => {
                                this.is25PercentActive = false;
                            }
                        });
                        this.endPicker = flatpickr(this.$refs.endInput, {
                            ...config,
                            defaultDate: this.endTime,
                            onChange: () => {
                                this.is25PercentActive = false;
                            }
                        });
                        this.extraPicker = flatpickr(this.$refs.extraInput, {
                            ...config,
                            defaultDate: this.extraTime,
                            onChange: () => {
                                this.is25PercentActive = false;
                            }
                        });
                    });
                },
                selectIncrement(value) {
                    this.increment = value;
                },
                resetCalculation() {
                    this.is25PercentActive = false;
                },
                calculate25Percent() {
                    const [startHour, startMin] = this.startTime.split(':').map(Number);
                    const [endHour, endMin] = this.endTime.split(':').map(Number);

                    const startMinutes = startHour * 60 + startMin;
                    const endMinutes = endHour * 60 + endMin;
                    const duration = endMinutes - startMinutes;

                    const extraDuration = Math.floor(duration * 0.25);
                    const extraEndMinutes = endMinutes + extraDuration;

                    const roundedMinutes = Math.ceil(extraEndMinutes / 5) * 5;

                    const finalHour = Math.floor(roundedMinutes / 60) % 24;
                    const finalMin = roundedMinutes % 60;

                    const newExtraTime = `${String(finalHour).padStart(2, '0')}:${String(finalMin).padStart(2, '0')}`;

                    this.extraTime = newExtraTime;
                    this.is25PercentActive = true;
                    if (this.extraPicker) {
                        this.extraPicker.setDate(newExtraTime);
                    }
                },
                startExam() {
                    const params = new URLSearchParams({
                        start: this.startTime,
                        end: this.endTime,
                        extra: this.extraTime,
                        increment: this.increment
                    });
                    window.location.href = `display.html?${params.toString()}`;
                }
            },
            mounted() {
                this.initTimePickers();
            }
        }).mount('#app');
    </script>
</body>
</html>
